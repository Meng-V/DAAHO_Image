<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LOC15 Metadata Viewer</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 2rem;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        header {
            text-align: center;
            color: white;
            margin-bottom: 2rem;
        }

        header h1 {
            font-size: 2.5rem;
            margin-bottom: 0.5rem;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        header p {
            font-size: 1.1rem;
            opacity: 0.9;
        }

        .search-bar {
            background: white;
            padding: 1rem;
            border-radius: 12px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            margin-bottom: 2rem;
        }

        .search-bar input {
            width: 100%;
            padding: 0.75rem 1rem;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            font-size: 1rem;
            transition: border-color 0.3s;
        }

        .search-bar input:focus {
            outline: none;
            border-color: #667eea;
        }

        .items-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(400px, 1fr));
            gap: 2rem;
        }

        .item-card {
            background: white;
            border-radius: 12px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            overflow: hidden;
            transition: transform 0.3s, box-shadow 0.3s;
        }

        .item-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 8px 12px rgba(0,0,0,0.15);
        }

        .image-container {
            width: 100%;
            height: 300px;
            background: #f7fafc;
            display: flex;
            align-items: center;
            justify-content: center;
            overflow: hidden;
            border-bottom: 3px solid #667eea;
        }

        .image-container img {
            max-width: 100%;
            max-height: 100%;
            object-fit: contain;
        }

        .image-container.no-image {
            color: #a0aec0;
            font-size: 1rem;
        }

        .metadata-content {
            padding: 1.5rem;
        }

        .item-title {
            font-size: 1.25rem;
            font-weight: 600;
            color: #2d3748;
            margin-bottom: 0.5rem;
        }

        .item-generated-title {
            font-size: 0.9rem;
            color: #667eea;
            margin-bottom: 1rem;
            font-style: italic;
        }

        .metadata-field {
            margin-bottom: 0.75rem;
        }

        .field-label {
            font-weight: 600;
            color: #4a5568;
            font-size: 0.85rem;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 0.25rem;
        }

        .field-value {
            color: #2d3748;
            font-size: 0.95rem;
            line-height: 1.5;
        }

        .field-value.null {
            color: #cbd5e0;
            font-style: italic;
        }

        .field-value.array {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
        }

        .tag {
            background: #edf2f7;
            color: #4a5568;
            padding: 0.25rem 0.75rem;
            border-radius: 6px;
            font-size: 0.85rem;
        }

        .accordion {
            margin-top: 1rem;
            border-top: 1px solid #e2e8f0;
            padding-top: 1rem;
        }

        .accordion-item {
            margin-bottom: 0.5rem;
        }

        .accordion-header {
            background: #f7fafc;
            padding: 0.75rem 1rem;
            border-radius: 8px;
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: background 0.3s;
        }

        .accordion-header:hover {
            background: #edf2f7;
        }

        .accordion-header .label {
            font-weight: 600;
            color: #4a5568;
            font-size: 0.9rem;
        }

        .accordion-header .icon {
            font-size: 1.2rem;
            color: #a0aec0;
            transition: transform 0.3s;
        }

        .accordion-header.active .icon {
            transform: rotate(180deg);
        }

        .accordion-content {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.3s ease-out;
        }

        .accordion-content.active {
            max-height: 500px;
            overflow-y: auto;
        }

        .accordion-content-inner {
            padding: 1rem;
            background: #fafafa;
            border-radius: 0 0 8px 8px;
            margin-top: 0.25rem;
        }

        .accordion-content pre {
            white-space: pre-wrap;
            word-wrap: break-word;
            font-size: 0.85rem;
            line-height: 1.6;
            color: #2d3748;
            font-family: 'Monaco', 'Menlo', monospace;
        }

        .context-badge {
            display: inline-block;
            background: #764ba2;
            color: white;
            padding: 0.25rem 0.75rem;
            border-radius: 6px;
            font-size: 0.75rem;
            margin-top: 0.5rem;
        }

        .loading {
            text-align: center;
            color: white;
            font-size: 1.5rem;
            padding: 3rem;
        }

        .no-results {
            text-align: center;
            color: white;
            font-size: 1.2rem;
            padding: 3rem;
        }

        @media (max-width: 768px) {
            .items-grid {
                grid-template-columns: 1fr;
            }
            
            header h1 {
                font-size: 2rem;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>üñºÔ∏è LOC15 Metadata Viewer</h1>
            <p>Browse your digitized collection with extracted metadata</p>
        </header>

        <div class="search-bar">
            <input type="text" id="searchInput" placeholder="üîç Search by title, creator, subjects, description...">
        </div>

        <div id="loading" class="loading">Loading items...</div>
        <div id="itemsContainer" class="items-grid" style="display: none;"></div>
        <div id="noResults" class="no-results" style="display: none;">No items found matching your search.</div>
    </div>

    <script>
        let allItems = [];

        // Fetch items on page load
        async function loadItems() {
            try {
                const response = await fetch('data.json');
                allItems = await response.json();
                document.getElementById('loading').style.display = 'none';
                document.getElementById('itemsContainer').style.display = 'grid';
                renderItems(allItems);
            } catch (error) {
                console.error('Error loading items:', error);
                document.getElementById('loading').innerHTML = '‚ùå Error loading items';
            }
        }

        // Render items to the DOM
        function renderItems(items) {
            const container = document.getElementById('itemsContainer');
            const noResults = document.getElementById('noResults');
            
            if (items.length === 0) {
                container.style.display = 'none';
                noResults.style.display = 'block';
                return;
            }
            
            container.style.display = 'grid';
            noResults.style.display = 'none';
            container.innerHTML = '';

            items.forEach(item => {
                const card = createItemCard(item);
                container.appendChild(card);
            });
        }

        // Create a card for an item
        function createItemCard(item) {
            const card = document.createElement('div');
            card.className = 'item-card';

            const metadata = item.metadata;
            const context = item.context;

            // Image section
            const imageHtml = item.image 
                ? `<img src="${item.image}" alt="${item.filename}" loading="lazy">`
                : '<div class="no-image">üìÑ No image available</div>';

            // Basic metadata fields
            const basicFields = ['creator', 'date', 'place', 'language', 'collection', 'repository'];
            const basicFieldsHtml = basicFields
                .map(field => {
                    const value = metadata[field];
                    if (value === null || value === undefined || value === '') return '';
                    return `
                        <div class="metadata-field">
                            <div class="field-label">${field}</div>
                            <div class="field-value">${value}</div>
                        </div>
                    `;
                })
                .join('');

            // Array fields (subjects, theme, genre)
            const arrayFieldsHtml = ['subjects', 'theme', 'genre']
                .map(field => {
                    const value = metadata[field];
                    if (!value || value.length === 0) return '';
                    const tags = value.map(v => `<span class="tag">${v}</span>`).join('');
                    return `
                        <div class="metadata-field">
                            <div class="field-label">${field}</div>
                            <div class="field-value array">${tags}</div>
                        </div>
                    `;
                })
                .join('');

            // Description
            const descriptionHtml = metadata.description ? `
                <div class="metadata-field">
                    <div class="field-label">Description</div>
                    <div class="field-value">${metadata.description}</div>
                </div>
            ` : '';

            // Accordion sections for long text fields
            const transcriptHtml = metadata.transcript ? `
                <div class="accordion-item">
                    <div class="accordion-header" onclick="toggleAccordion(this)">
                        <span class="label">üìù Transcript</span>
                        <span class="icon">‚ñº</span>
                    </div>
                    <div class="accordion-content">
                        <div class="accordion-content-inner">
                            <pre>${metadata.transcript}</pre>
                        </div>
                    </div>
                </div>
            ` : '';

            const textReadingHtml = metadata.text_reading ? `
                <div class="accordion-item">
                    <div class="accordion-header" onclick="toggleAccordion(this)">
                        <span class="label">üìñ Text Reading</span>
                        <span class="icon">‚ñº</span>
                    </div>
                    <div class="accordion-content">
                        <div class="accordion-content-inner">
                            <pre>${metadata.text_reading}</pre>
                        </div>
                    </div>
                </div>
            ` : '';

            // Context info
            const contextHtml = `
                <span class="context-badge">Model: ${context.model || 'unknown'}</span>
                <span class="context-badge">Confidence: ${Math.round(context.processing_confidence || 0)}%</span>
            `;

            card.innerHTML = `
                <div class="image-container ${!item.image ? 'no-image' : ''}">
                    ${imageHtml}
                </div>
                <div class="metadata-content">
                    <div class="item-title">${metadata.title || item.filename}</div>
                    ${metadata.generated_title ? `<div class="item-generated-title">${metadata.generated_title}</div>` : ''}
                    ${basicFieldsHtml}
                    ${arrayFieldsHtml}
                    ${descriptionHtml}
                    ${transcriptHtml || textReadingHtml ? '<div class="accordion">' + transcriptHtml + textReadingHtml + '</div>' : ''}
                    <div style="margin-top: 1rem;">
                        ${contextHtml}
                    </div>
                </div>
            `;

            return card;
        }

        // Toggle accordion
        function toggleAccordion(header) {
            const content = header.nextElementSibling;
            const isActive = header.classList.contains('active');

            // Close all accordions in this card
            const card = header.closest('.item-card');
            card.querySelectorAll('.accordion-header').forEach(h => h.classList.remove('active'));
            card.querySelectorAll('.accordion-content').forEach(c => c.classList.remove('active'));

            // Open this one if it wasn't active
            if (!isActive) {
                header.classList.add('active');
                content.classList.add('active');
            }
        }

        // Search functionality
        document.getElementById('searchInput').addEventListener('input', (e) => {
            const query = e.target.value.toLowerCase();
            
            if (!query) {
                renderItems(allItems);
                return;
            }

            const filtered = allItems.filter(item => {
                const metadata = item.metadata;
                const searchableText = [
                    item.filename,
                    metadata.title,
                    metadata.generated_title,
                    metadata.creator,
                    metadata.description,
                    metadata.collection,
                    ...(metadata.subjects || []),
                    ...(metadata.theme || []),
                    ...(metadata.genre || [])
                ].filter(Boolean).join(' ').toLowerCase();

                return searchableText.includes(query);
            });

            renderItems(filtered);
        });

        // Load items when page loads
        loadItems();
    </script>
</body>
</html>
